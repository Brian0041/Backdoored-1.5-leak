package com.backdoored.hacks.exploit;

import net.minecraftforge.fml.common.eventhandler.SubscribeEvent;
import java.time.temporal.Temporal;
import java.time.Duration;
import net.minecraft.network.play.client.CPacketKeepAlive;
import com.backdoored.event.PacketSent;
import com.backdoored.gui.CategoriesInit;
import java.time.Instant;
import com.backdoored.setting.Setting;
import com.backdoored.hacks.BaseHack;

public class PingSpoof extends BaseHack
{
    private final Setting delay;
    private Instant lastSent;
    
    public PingSpoof() {
        super("Ping Spoof", "Spoof your ping retard", CategoriesInit.EXPLOIT);
        this.lastSent = Instant.now();
        this.delay = new Setting("Delay", this, 20, 1, 300);
    }
    
    @SubscribeEvent
    public void onPacketSent(final PacketSent event) {
        if (event.packet instanceof CPacketKeepAlive && this.getEnabled()) {
            final Instant now = Instant.now();
            if (Duration.between(this.lastSent, now).getSeconds() >= this.delay.getValInt() / 10.0f) {
                this.lastSent = Instant.now();
                event.setCanceled(false);
            }
            else {
                event.setCanceled(true);
            }
        }
    }
}
